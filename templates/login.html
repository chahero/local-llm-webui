<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 - Local LLM WebUI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#0f172a',
                            900: '#0f172a',
                            925: '#06111f'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex items-center justify-center p-4">
    <!-- 토스트 컨테이너 -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- 회원가입 모달 -->
    <div id="register-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-40 p-4">
        <div class="bg-slate-900 rounded-xl shadow-2xl w-full max-w-sm border border-slate-700 animate-in fade-in zoom-in-95">
            <div class="flex justify-between items-center p-6 border-b border-slate-700">
                <h2 class="text-xl font-bold text-white">회원가입</h2>
                <button id="modal-close" class="text-slate-400 hover:text-slate-200 text-2xl leading-none transition">&times;</button>
            </div>

            <form id="register-form" class="p-6 space-y-4">
                <div>
                    <label for="reg-username" class="block text-sm font-medium text-slate-300 mb-2">사용자명</label>
                    <input
                        type="text"
                        id="reg-username"
                        placeholder="사용자명을 입력해주세요"
                        required
                        class="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition"
                    >
                </div>

                <div>
                    <label for="reg-password" class="block text-sm font-medium text-slate-300 mb-2">비밀번호</label>
                    <input
                        type="password"
                        id="reg-password"
                        placeholder="비밀번호를 입력해주세요 (최소 4자)"
                        required
                        minlength="4"
                        class="w-full px-4 py-2 bg-slate-800 border border-slate-700 rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition"
                    >
                </div>

                <div class="flex gap-3 pt-2">
                    <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition">가입하기</button>
                    <button type="button" id="modal-cancel" class="flex-1 px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-100 font-medium rounded-lg transition">취소</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 로그인 박스 -->
    <div class="w-full max-w-sm">
        <div class="bg-slate-900 rounded-2xl shadow-2xl border border-slate-700 p-8">
            <!-- 헤더 -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">Local LLM WebUI</h1>
                <p class="text-slate-400">로그인 해주세요</p>
            </div>

            <!-- 로그인 폼 -->
            <form id="login-form" class="space-y-5">
                <div>
                    <label for="username" class="block text-sm font-medium text-slate-300 mb-2">사용자명</label>
                    <input
                        type="text"
                        id="username"
                        placeholder="사용자명을 입력해주세요"
                        required
                        autocomplete="username"
                        class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition"
                    >
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-slate-300 mb-2">비밀번호</label>
                    <input
                        type="password"
                        id="password"
                        placeholder="비밀번호를 입력해주세요"
                        required
                        autocomplete="current-password"
                        class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-lg text-slate-100 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition"
                    >
                </div>

                <button type="submit" id="login-btn" class="w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition active:scale-95">로그인</button>
            </form>

            <!-- 회원가입 링크 -->
            <div class="mt-6 pt-6 border-t border-slate-700 text-center text-sm text-slate-400">
                새로운 계정을 만들려면?
                <a href="#" id="register-link" class="text-blue-500 hover:text-blue-400 font-medium transition">가입하기</a>
            </div>
        </div>
    </div>

    <script>
        // 요소들
        const form = document.getElementById('login-form');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('login-btn');
        const registerLink = document.getElementById('register-link');

        const registerModal = document.getElementById('register-modal');
        const registerForm = document.getElementById('register-form');
        const regUsernameInput = document.getElementById('reg-username');
        const regPasswordInput = document.getElementById('reg-password');
        const modalClose = document.getElementById('modal-close');
        const modalCancel = document.getElementById('modal-cancel');

        // 이벤트 리스너
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            await login();
        });

        registerLink.addEventListener('click', (e) => {
            e.preventDefault();
            openRegisterModal();
        });

        modalClose.addEventListener('click', closeRegisterModal);
        modalCancel.addEventListener('click', closeRegisterModal);

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            await registerUser();
        });

        registerModal.addEventListener('click', (e) => {
            if (e.target === registerModal) {
                closeRegisterModal();
            }
        });

        // 모달 함수
        function openRegisterModal() {
            registerModal.classList.remove('hidden');
            regUsernameInput.focus();
        }

        function closeRegisterModal() {
            registerModal.classList.add('hidden');
            registerForm.reset();
        }

        // 로그인
        async function login() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value;

            if (!username || !password) {
                showToast('사용자명과 비밀번호를 입력해주세요', 'error');
                return;
            }

            loginBtn.disabled = true;
            loginBtn.textContent = '로그인 중...';

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('로그인 성공!', 'success');
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 500);
                } else {
                    showToast(data.message || '로그인 실패', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showToast('로그인 중 오류가 발생했습니다', 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = '로그인';
            }
        }

        // 회원가입
        async function registerUser() {
            const username = regUsernameInput.value.trim();
            const password = regPasswordInput.value;

            if (!username || !password) {
                showToast('사용자명과 비밀번호를 입력해주세요', 'error');
                return;
            }

            if (password.length < 4) {
                showToast('비밀번호는 최소 4자 이상이어야 합니다', 'error');
                return;
            }

            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success) {
                    showToast('가입 성공! 로그인해주세요', 'success');
                    closeRegisterModal();
                    usernameInput.value = username;
                    passwordInput.value = '';
                    passwordInput.focus();
                } else {
                    showToast(data.message || '가입 실패', 'error');
                }
            } catch (error) {
                console.error('Register error:', error);
                showToast('가입 중 오류가 발생했습니다', 'error');
            }
        }

        // 토스트
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');

            const styles = {
                success: 'bg-emerald-900 border-emerald-700 text-emerald-100',
                error: 'bg-red-900 border-red-700 text-red-100',
                info: 'bg-blue-900 border-blue-700 text-blue-100'
            };

            const icons = {
                success: '✓',
                error: '✕',
                info: 'ℹ'
            };

            toast.className = `flex items-center gap-3 px-4 py-3 rounded-lg border ${styles[type]} shadow-lg animate-in fade-in slide-in-from-right-full duration-300`;
            toast.innerHTML = `
                <span class="text-lg font-bold flex-shrink-0">${icons[type]}</span>
                <span class="flex-1">${message}</span>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.remove('fade-in', 'slide-in-from-right-full');
                toast.classList.add('fade-out', 'slide-out-to-right-full');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
